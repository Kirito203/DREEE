[gd_scene load_steps=17 format=3 uid="uid://bh0q2t7j3qb7h"]

[ext_resource type="PackedScene" uid="uid://dkjaeh2f6al3e" path="res://scene/levels/Level_001/Chunks/chunk_generator.tscn" id="1_mvwwc"]
[ext_resource type="PackedScene" uid="uid://btq4fy5ua2nmw" path="res://scene/player/player.tscn" id="2_oqfqr"]
[ext_resource type="PackedScene" uid="uid://cugdtqfggtr4x" path="res://scene/levels/Level_001/Chunks/chunk_template_001.tscn" id="2_yt5y6"]
[ext_resource type="PackedScene" uid="uid://cxr7avd6hkkfb" path="res://scene/levels/Level_001/Chunks/chunk_template_002.tscn" id="3_mvwwc"]
[ext_resource type="FontFile" uid="uid://cjokbv0q3hkcl" path="res://resources/shrifts/LCD16x2Display-Regular.otf" id="5_b0rlp"]
[ext_resource type="Texture2D" uid="uid://d05srxlq0wtr" path="res://scene/UI/XP/Honor_bar_under.png" id="8_xh8cu"]
[ext_resource type="PackedScene" uid="uid://dqg1eynftmv2p" path="res://scene/levels/Menu/level_up_screen.tscn" id="9_12d63"]
[ext_resource type="Texture2D" uid="uid://sqho08n5288w" path="res://scene/UI/XP/Honor_bar_over.png" id="9_hso7i"]
[ext_resource type="Texture2D" uid="uid://8h1ivp8n5277" path="res://scene/UI/HP/HP2_under.png" id="9_jmnj1"]
[ext_resource type="Texture2D" uid="uid://d4lsby3vjdtat" path="res://scene/UI/HP/HP2_over.png" id="10_b0rlp"]
[ext_resource type="Texture2D" uid="uid://3jxs0e671gmx" path="res://scene/UI/XP/Honor_bar_progress.png" id="10_d68tj"]
[ext_resource type="Texture2D" uid="uid://ce4wagk56f0ml" path="res://scene/UI/HP/HP2_progress.png" id="11_vdm5l"]
[ext_resource type="Script" uid="uid://0txbaqt0632c" path="res://scene/levels/xp_tex.gd" id="12_b0rlp"]
[ext_resource type="Script" uid="uid://cpoj43w1oc6sh" path="res://scene/levels/hp_tex.gd" id="12_jmnj1"]

[sub_resource type="Environment" id="Environment_vdm5l"]
background_mode = 3
glow_enabled = true
glow_intensity = 8.0

[sub_resource type="GDScript" id="GDScript_jmnj1"]
script/source = "extends Control

@onready var timer_label: Label = $TimerLabel
@export var font: FontFile

@export var game_time: float = 0.0
## Выставляется в миллисекундах
@export var max_game_time: float = 2400.0

@export_category(\"Настройка текста\")
## Цвет текста таймера
@export var text_color: Color = Color.WHITE

func _ready() -> void:
	if font:
		timer_label.add_theme_font_override(\"font\", font)
	
	# Устанавливаем цвет текста
	timer_label.add_theme_color_override(\"font_color\", text_color)
	update_display()

func _process(delta: float) -> void:
	game_time += delta
	update_display()
	
	# Проверка окончания игры
	if game_time >= max_game_time:
		end_game()

func update_display() -> void:
	var minutes: int = int(game_time) / 60
	var seconds: int = int(game_time) % 60
	timer_label.text = \"%02d:%02d\" % [minutes, seconds]

func end_game() -> void:
	# Останавливаем игру
	get_tree().paused = true
	
	# Показываем экран окончания игры
	#var end_screen = preload(\"res://ui/end_screen.tscn\").instantiate()
	#get_tree().root.add_child(end_screen)
	
	# Сохраняем статистику
	if GameStats:
		GameStats.final_game_time = game_time
"

[node name="Level_001" type="Node"]

[node name="Enviroments" type="Node" parent="."]

[node name="ChunkGenerator" parent="Enviroments" instance=ExtResource("1_mvwwc")]
visible = false
chunk_variants = Array[PackedScene]([ExtResource("2_yt5y6"), ExtResource("3_mvwwc")])

[node name="WorldEnvironment" type="WorldEnvironment" parent="Enviroments"]
environment = SubResource("Environment_vdm5l")

[node name="Player" type="Node" parent="."]

[node name="Player" parent="Player" instance=ExtResource("2_oqfqr")]
position = Vector2(320, 180)

[node name="MobsPool" type="Node" parent="."]

[node name="EyeBallPool" type="Node" parent="MobsPool"]

[node name="PickUpElements" type="Node" parent="."]

[node name="Light" type="Node" parent="."]

[node name="DirectionalLight2D" type="DirectionalLight2D" parent="Light"]
blend_mode = 1
range_layer_max = 1

[node name="FX" type="Node" parent="."]

[node name="UI" type="CanvasLayer" parent="."]
layer = 2

[node name="XP_tex" type="TextureProgressBar" parent="UI"]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -450.0
offset_top = -48.0
offset_right = 450.0
grow_horizontal = 2
grow_vertical = 0
texture_under = ExtResource("8_xh8cu")
texture_over = ExtResource("9_hso7i")
texture_progress = ExtResource("10_d68tj")
script = ExtResource("12_b0rlp")

[node name="HP_tex" type="TextureProgressBar" parent="UI"]
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -128.0
offset_right = 128.0
offset_bottom = 48.0
grow_horizontal = 2
value = 50.0
texture_under = ExtResource("9_jmnj1")
texture_over = ExtResource("10_b0rlp")
texture_progress = ExtResource("11_vdm5l")
tint_progress = Color(0.99004, 0, 0.00301664, 1)
script = ExtResource("12_jmnj1")

[node name="Timer" type="Control" parent="UI"]
layout_mode = 3
anchor_left = 0.5
anchor_top = 0.11851852
anchor_right = 0.5
anchor_bottom = 0.11851852
grow_horizontal = 2
script = SubResource("GDScript_jmnj1")
font = ExtResource("5_b0rlp")
metadata/_edit_use_anchors_ = true

[node name="TimerLabel" type="Label" parent="UI/Timer"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -24.0
offset_top = -11.5
offset_right = 24.0
offset_bottom = 11.5
grow_horizontal = 2
grow_vertical = 2

[node name="LevelUpScreen" parent="." instance=ExtResource("9_12d63")]
visible = false
